<html>
    <head>
        <title>Uno dos Gugu</title>
        <meta charset="utf8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="./css/style.css">
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.3.0/socket.io.js"></script>
        <script>
            const socket = io('http://localhost:3000');

            var infoUsuario = {
                apelido:    '',
                id:         '',
                conectado:  false,
                sala:       undefined,
                infoSala:   undefined
            }

            socket.on('connect', () => {
                console.log("Conectado ao servidor...");
            })

            socket.on('infoUsuario', (info) => {
                console.log("Preenchendo meus dados com recebimento do servidor...");
                let apelido = info[1];
                let id = info[0];
                infoUsuario.apelido         = apelido;
                infoUsuario.id              = id;
                infoUsuario.conectado       = true;
            })

            function enviaApelido() {
                let apelido = document.getElementById('apelido').value;
                socket.emit('novoUsuario', apelido);
                
                document.getElementById('pseudo-login').style.display = "none";

                document.getElementById('enter-room').style.display = "initial";

            }

            function salaExistente() {
                let sala = document.getElementById('idSala').value;
                socket.emit('logaSala', sala);
            }

            function criarSala() {
                socket.emit('criarSala', 0);
            }

            socket.on('entrarSala', response => {

                if(response.status == true) {
                    infoUsuario.sala = response.id;
                    renderSala();
                } else {
                    alert("Esta sala não existe meu casinha");
                }

            })

            socket.on('salaCriada', response => {
                console.log(response);

                infoUsuario.sala = response;
                renderSala();

            })

            socket.on('salaDevolvida', sala => {
                console.log(sala);
            });

            socket.on('jogoIniciado', (response) => {
                console.log(response);
            })

            function renderSala() {
                socket.emit('pedeSala', {sala: infoUsuario.sala, id_jogador: infoUsuario.id, apelido_jogador: infoUsuario.apelido});
                document.getElementById('game-room').style.display  = "initial";
                document.getElementById('enter-room').style.display = "none";
            }

            function iniciaJogo() {
                socket.emit('iniciaJogo', infoUsuario.sala);
            }


        </script>
    </head>
    <body style="background-image: url('https://cdn.hipwallpaper.com/i/48/64/OR5iNS.jpg');">
        
        <div class="container-fluid" id="pseudo-login" style="display: none">
            <div style="margin-top: 5%;"></div>
                <label for="apelido">Apelido:</label>
                <input type="text" id="apelido" class="form-control">
                <button class="btn btn-dark" onclick="enviaApelido()">ENTRAR</button>
            </div>
        </div>

        <div class="container-fluid" id="enter-room" style="display: none">

            <label for="idSala">ID da Sala:</label>
            <input type="text" id="idSala" class="form-control" style="margin-bottom: 5%;">
            <button class="btn btn-dark" onclick="salaExistente()">Sala existente</button>
            <button class="btn btn-dark" style="margin-left: 10%" onclick="criarSala()">Criar sala</button>

        </div>

        <div class="container-fluid" id="game-room" style="display: initial;" >
            
            <div id="enemy-cards" class="enemy-cards">
                <div class="cards">
                    <img class="card" src="/sliced/back.png">
                    <img class="card" src="/sliced/back.png">
                    <img class="card" src="/sliced/back.png">
                    <img class="card" src="/sliced/back.png">
                    <img class="card" src="/sliced/back.png">
                    <img class="card" src="/sliced/back.png">
                    <img class="card" src="/sliced/back.png">
                </div>
            </div>

            <div id="central-card" class="central-card">
                <div class="cards">
                    <img class="c-card" src="/sliced/1-b.png">
                </div>
            </div>

            <div id="your-cards" class="your-cards">
                <div class="cards">
                    <img class="card" src="/sliced/2-b.png">
                    <img class="card" src="/sliced/2-g.png">
                    <img class="card" src="/sliced/2-r.png">
                    <img class="card" src="/sliced/2-y.png">
                </div>
            </div>

        </div>

    
        <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"></script>
    </body>
</html>